(this["webpackJsonpuq-bus-web"]=this["webpackJsonpuq-bus-web"]||[]).push([[0],{11:function(t,e,n){t.exports=n(18)},16:function(t,e,n){},18:function(t,e,n){"use strict";n.r(e);var s=n(1),r=n(2),i=n(4),o=n(3),a=n(5),u=n(0),c=n.n(u),h=n(6),p=n.n(h),l=(n(16),n(9)),d=n(10),f=n(8),g=n.n(f),m=[{key:"no",name:"No.",sortable:!0},{key:"route",name:"Route"},{key:"stop",name:"Stop",sortable:!0},{key:"time",name:"Time",sortable:!0,sortDescendingFirst:!0}],v=function(t){function e(){var t,n;Object(s.a)(this,e);for(var r=arguments.length,a=new Array(r),u=0;u<r;u++)a[u]=arguments[u];return(n=Object(i.a)(this,(t=Object(o.a)(e)).call.apply(t,[this].concat(a)))).state={rows:n.convertBuses(n.props.buses),initialRows:n.convertBuses(n.props.buses)},n.onGridRowsUpdated=function(t){var e=t.fromRow,s=t.toRow,r=t.updated;n.setState((function(t){for(var n=t.rows.slice(),i=e;i<=s;i++)n[i]=Object(d.a)({},n[i],{},r);return{rows:n}}))},n.sortRows=function(t,e,s){return"NONE"===s?t:Object(l.a)(n.state.rows).sort((function(t,n){return"ASC"===s?t[e]>n[e]?1:-1:"DESC"===s?t[e]<n[e]?1:-1:void 0}))},n}return Object(a.a)(e,t),Object(r.a)(e,[{key:"convertBuses",value:function(t){for(var e=[],n=0;n<t.length;n++){var s=t[n],r={no:s.routeShortName,route:s.routeLongName,stop:s.stopName,time:s.time};e.push(r)}return e}},{key:"componentDidMount",value:function(){this.setState({rows:this.convertBuses(this.props.buses),initialRows:this.state.rows})}},{key:"componentWillReceiveProps",value:function(t){this.setState({rows:this.convertBuses(this.props.buses),initialRows:this.state.rows})}},{key:"setRows",value:function(t){this.setState({rows:t,initialRows:this.state.rows})}},{key:"render",value:function(){var t=this;return c.a.createElement(g.a,{columns:m,rowGetter:function(e){return t.state.rows[e]},rowsCount:this.state.rows.length,onGridRowsUpdated:this.onGridRowsUpdated,onGridSort:function(e,n){return t.setRows(t.sortRows(t.state.initialRows,e,n))},enableCellSelect:!0})}}]),e}(c.a.Component),b=function(){function t(e,n,r,i,o){var a=this;Object(s.a)(this,t),this.tripId=e,this.stopId=n,this.direction=i,this.time="Loading... ",this.trip="Loading... ",this.route="Loading...  ",this.routeLongName="Loading...  ",this.routeShortName="Loading...  ",this.stop="Loading...  ",this.stopName="Loading...  ",this.getTripPromise(this.tripId).then(function(t){return this.trip=t[0],this.getRoutePromise(t[0].route_id)}.bind(this)).then(function(t){this.route=t,this.routeLongName=t[0].route_long_name,this.routeShortName=t[0].route_short_name}.bind(this)).then(function(){this.time=r,o.stateUpdateCallback()}.bind(this)),this.getStopPromise(n).then(function(t){this.stop=t,this.stopName=t[0].stop_name}.bind(this)).then((function(){return o.stateUpdateCallback(a,a.direction)}))}return Object(r.a)(t,[{key:"getTripPromise",value:function(t){return fetch("http://uqbus.richal.tech/trip/trip_id/"+t+"/").then((function(t){return t.json()}))}},{key:"getRoutePromise",value:function(t){return fetch("http://uqbus.richal.tech/route/route_id/"+t+"/").then((function(t){return t.json()}))}},{key:"getStopPromise",value:function(t){return fetch("http://uqbus.richal.tech/stop/stop_id/"+t+"/").then((function(t){return t.json()}))}},{key:"getTripUpdatePromise",value:function(t){return fetch("http://uqbus.richal.tech/trip_update/trip_id/"+t+"/").then((function(t){return t.json()}))}},{key:"getStopTimeUpdate",value:function(t){return fetch("http://uqbus.richal.tech/stop_time_update/trip_update_id/"+t+"/").then((function(t){return t.json()}))}}]),t}(),w=["1853","1877","1878","1880","1883","1882"],S=function(t){function e(){var t,n;Object(s.a)(this,e);for(var r=arguments.length,a=new Array(r),u=0;u<r;u++)a[u]=arguments[u];return(n=Object(i.a)(this,(t=Object(o.a)(e)).call.apply(t,[this].concat(a)))).state={departingBuses:[],arrivingBuses:[]},n}return Object(a.a)(e,t),Object(r.a)(e,[{key:"componentDidMount",value:function(){this.getBuses()}},{key:"stateUpdateCallback",value:function(t,e){var n=[t];"departing"===e?(n=this.state.departingBuses.concat(n),this.setState({departingBuses:n,arrivingBuses:this.state.arrivingBuses})):"arriving"===e&&(n=this.state.arrivingBuses.concat(n),this.setState({departingBuses:this.state.departingBuses,arrivingBuses:n})),this.forceUpdate()}},{key:"getBusesForStop",value:function(t){var e=new Date,n=new Date(e.toLocaleString("en-US",{timezone:"Australia/Brisbane"})),s=n.getFullYear()+"-"+(n.getMonth()+1).toString().padStart(2,"0")+"-"+n.getDate().toString().padStart(2,"0"),r=n.getHours().toString().padStart(2,"0")+":"+n.getMinutes().toString().padStart(2,"0")+":"+n.getSeconds().toString().padStart(2,"0");return fetch("http://uqbus.richal.tech/stop_time/stop_id/"+t+"/current_time/"+s+" "+r+"/").then((function(t){return t.json()}))}},{key:"getBuses",value:function(){for(var t=this,e=[],n=[],s=0;s<w.length;s++)e=e.concat(this.getBusesForStop(w[s]));Promise.all(e).then((function(e){e.forEach((function(t){return n=n.concat(t)})),n.forEach((function(e){var n="1882"!==e.stop_id?"departing":"arriving",s=new b(e.trip_id,e.stop_id,e.departure_time,n,t);console.log(s)}))}))}},{key:"render",value:function(){return c.a.createElement("div",{className:"BusTable"},c.a.createElement("h2",null,"Departures"),c.a.createElement(v,{app:this,buses:this.state.departingBuses}),c.a.createElement("h2",null,"Arrivals"),c.a.createElement(v,{app:this,buses:this.state.arrivingBuses}))}}]),e}(c.a.Component);p.a.render(c.a.createElement(S,null),document.getElementById("root"))}},[[11,1,2]]]);
//# sourceMappingURL=main.6e6f4ef1.chunk.js.map