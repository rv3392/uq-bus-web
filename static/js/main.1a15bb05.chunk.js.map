{"version":3,"sources":["BusDisplayTable.js","index.js"],"names":["BusDisplayTable","buses","length","map","bus","index","key","route_long_name","tripId","stopId","departureTime","uqStops","Bus","application","this","trip","route","route_short_name","getTripPromise","then","locTrip","console","log","getRoutePromise","route_id","bind","locRoute","stateUpdateCallback","fetch","res","json","routeId","tripUpdateId","App","state","getBuses","forceUpdate","today","Date","today_brisbane","toLocaleString","timezone","date","getFullYear","getMonth","getDate","time","getHours","getMinutes","getSeconds","busPromises","stopTimes","importedBuses","i","concat","getBusesForStop","Promise","all","values","forEach","value","busJSON","trip_id","stop_id","departure_time","push","setState","className","React","Component","ReactDOM","render","document","getElementById"],"mappings":"kNA+BeA,G,MA7BS,SAAC,GAAa,IAAZC,EAAW,EAAXA,MACtB,OACI,+BACI,+BACI,4BACI,0CACA,uCACA,uCACA,gDAGR,+BAESA,EAAMC,OAAS,EAAKD,EAAME,KAAI,SAACC,EAAKC,GACjC,OACI,wBAAIC,IAAOD,GACP,4BAAKD,EAAIG,iBACT,4BAAKH,EAAII,QACT,4BAAKJ,EAAIK,QACT,4BAAKL,EAAIM,mBAGhB,4BAAI,+CCdvBC,EAAU,CAAC,OAAQ,OAAQ,OAAQ,OAAQ,QAE3CC,E,WACJ,WAAYJ,EAAQC,EAAQC,EAAeG,GAAc,oBACvDC,KAAKN,OAASA,EACdM,KAAKL,OAASA,EACdK,KAAKJ,cAAgBA,EAErBI,KAAKC,KAAO,aACZD,KAAKE,MAAQ,aACbF,KAAKP,gBAAkB,aACvBO,KAAKG,iBAAmB,aAELH,KAAKI,eAAeJ,KAAKN,QAAQW,KAAK,SAASC,GAGhE,OAFAN,KAAKC,KAAOK,EAAQ,GACpBC,QAAQC,IAAIF,EAAQ,IACbN,KAAKS,gBAAgBH,EAAQ,GAAGI,WACvCC,KAAKX,OAE6BK,KAAK,SAASO,GAChDZ,KAAKE,MAAQU,EACbZ,KAAKP,gBAAkBmB,EAAS,GAAGnB,gBACnCO,KAAKG,iBAAmBS,EAAS,GAAGT,iBACpCI,QAAQC,IAAII,IACZD,KAAKX,OAEUK,MAAK,WACpBN,EAAYc,yB,2DAIDnB,GACb,OAAOoB,MAAM,yCAA2CpB,EAAS,KAC5DW,MAAK,SAAAU,GAAG,OAAIA,EAAIC,Y,sCAGPC,GACd,OAAOH,MAAM,2CAA6CG,EAAU,KAC/DZ,MAAK,SAAAU,GAAG,OAAIA,EAAIC,Y,2CAGFtB,GACnB,OAAOoB,MAAM,gDAAkDpB,EAAS,KACnEW,MAAK,SAAAU,GAAG,OAAIA,EAAIC,Y,wCAGLE,GAChB,OAAOJ,MAAM,4DAA8DI,EAAe,KACrFb,MAAK,SAAAU,GAAG,OAAIA,EAAIC,c,KAInBG,E,2MAEJC,MAAQ,CACNjC,MAAO,I,mFAIPa,KAAKqB,a,4CAILrB,KAAKsB,gB,sCAGS3B,GACd,IAAI4B,EAAQ,IAAIC,KACZC,EAAiB,IAAID,KAAKD,EAAMG,eAAe,QAAS,CAACC,SAAU,wBAEnEC,EAAOH,EAAeI,cAAgB,KAAOJ,EAAeK,WAAa,GAAK,IAAML,EAAeM,UACnGC,EAAOP,EAAeQ,WAAa,IAAMR,EAAeS,aAAe,IAAMT,EAAeU,aAEhG,OAAOrB,MAAM,8CACPnB,EAAS,iBAAmBiC,EAAO,IAAMI,EAAO,KACjD3B,MAAK,SAAAU,GACJ,OAAOA,EAAIC,Y,iCASjB,IALU,IAAD,OACLoB,EAAc,GACdC,EAAY,GACZC,EAAgB,GAEXC,EAAI,EAAGA,EAAI1C,EAAQT,OAAQmD,IAClCH,EAAcA,EAAYI,OAAOxC,KAAKyC,gBAAgB5C,EAAQ0C,KAGhEG,QAAQC,IAAIP,GAAa/B,MAAK,SAAAuC,GAC5BA,EAAOC,SAAQ,SAAAC,GAAK,OAAIT,EAAYA,EAAUG,OAAOM,MACrDT,EAAUQ,SAAQ,SAAAE,GAChB,IAAIzD,EACA,IAAIQ,EAAIiD,EAAQC,QAASD,EAAQE,QACjCF,EAAQG,eAAgB,GAC5BZ,EAAca,KAAK7D,MAGrB,EAAK8D,SAAS,CACZjE,MAAOmD,S,+BAOX,OACA,yBAAKe,UAAU,YACb,kBAAC,EAAD,CAAiBlE,MAASa,KAAKoB,MAAMjC,a,GAxDzBmE,IAAMC,WA8DxBC,IAASC,OACP,kBAAC,EAAD,MACAC,SAASC,eAAe,U","file":"static/js/main.1a15bb05.chunk.js","sourcesContent":["import React from 'react';\r\n\r\nconst BusDisplayTable = ({buses}) => {\r\n    return (\r\n        <table>\r\n            <thead>\r\n                <tr>\r\n                    <th>route_name</th>\r\n                    <th>trip_id</th>\r\n                    <th>stop_id</th>\r\n                    <th>departure_time</th>\r\n                </tr>\r\n            </thead>\r\n            <tbody>\r\n                {\r\n                    (buses.length > 0) ? buses.map((bus, index) => {\r\n                        return (\r\n                            <tr key = {index}>\r\n                                <td>{bus.route_long_name}</td>\r\n                                <td>{bus.tripId}</td>\r\n                                <td>{bus.stopId}</td>\r\n                                <td>{bus.departureTime}</td>\r\n                            </tr>\r\n                        )\r\n                    }) : <tr><td>Loading...</td></tr> \r\n                }\r\n            </tbody>\r\n        </table>\r\n    )\r\n}\r\n\r\nexport default BusDisplayTable;","import React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport './index.css';\r\nimport BusDisplayTable from './BusDisplayTable.js';\r\n\r\n//Gets bus details from 'trips' table using a trip_id\r\n//trip_id is one of the next 'x' busses departing from uq (stop_times)\r\n//Gets further bus details from 'routes' table using a route_id found in\r\n//'trips'\r\n\r\nconst uqStops = [\"1853\", \"1878\", \"1880\", \"1882\", \"1883\"];\r\n\r\nclass Bus {\r\n  constructor(tripId, stopId, departureTime, application) {\r\n    this.tripId = tripId;\r\n    this.stopId = stopId;\r\n    this.departureTime = departureTime;\r\n\r\n    this.trip = \"Loading...\";\r\n    this.route = \"Loading...\";\r\n    this.route_long_name = \"Loading...\";\r\n    this.route_short_name = \"Loading...\";\r\n\r\n    var routePromise = this.getTripPromise(this.tripId).then(function(locTrip) {\r\n      this.trip = locTrip[0];\r\n      console.log(locTrip[0]);\r\n      return this.getRoutePromise(locTrip[0].route_id);\r\n    }.bind(this));\r\n\r\n    var completedPromise = routePromise.then(function(locRoute) {\r\n      this.route = locRoute;\r\n      this.route_long_name = locRoute[0].route_long_name;\r\n      this.route_short_name = locRoute[0].route_short_name;\r\n      console.log(locRoute);\r\n    }.bind(this));\r\n\r\n    completedPromise.then(function() {\r\n      application.stateUpdateCallback();\r\n    });    \r\n  }\r\n\r\n  getTripPromise(tripId) {\r\n    return fetch(\"http://uqbus.richal.tech/trip/trip_id/\" + tripId + \"/\")\r\n        .then(res => res.json());\r\n  }\r\n\r\n  getRoutePromise(routeId) {\r\n    return fetch(\"http://uqbus.richal.tech/route/route_id/\" + routeId + \"/\")\r\n        .then(res => res.json());\r\n  }\r\n\r\n  getTripUpdatePromise(tripId) {\r\n    return fetch(\"http://uqbus.richal.tech/trip_update/trip_id/\" + tripId + \"/\")\r\n        .then(res => res.json());\r\n  }\r\n\r\n  getStopTimeUpdate(tripUpdateId) {\r\n    return fetch(\"http://uqbus.richal.tech/stop_time_update/trip_update_id/\" + tripUpdateId + \"/\")\r\n        .then(res => res.json());\r\n  }\r\n}\r\n\r\nclass App extends React.Component {\r\n\r\n  state = {\r\n    buses: []\r\n  };\r\n\r\n  componentDidMount() {\r\n    this.getBuses();\r\n  }\r\n\r\n  stateUpdateCallback() {\r\n    this.forceUpdate();\r\n  }\r\n\r\n  getBusesForStop(stopId) {\r\n    var today = new Date();\r\n    var today_brisbane = new Date(today.toLocaleString('en-US', {timezone: \"Australia/Brisbane\"}));\r\n\r\n    var date = today_brisbane.getFullYear() + '-' + (today_brisbane.getMonth() + 1) + '-' + today_brisbane.getDate();\r\n    var time = today_brisbane.getHours() + ':' + today_brisbane.getMinutes() + ':' + today_brisbane.getSeconds();\r\n\r\n    return fetch(\"http://uqbus.richal.tech/stop_time/stop_id/\" \r\n        + stopId + \"/current_time/\" + date + \" \" + time + \"/\")\r\n        .then(res => {\r\n          return res.json();\r\n        });\r\n  }\r\n\r\n  getBuses() {\r\n    var busPromises = [];\r\n    var stopTimes = [];\r\n    var importedBuses = [];\r\n\r\n    for (var i = 0; i < uqStops.length; i++) {\r\n      busPromises = busPromises.concat(this.getBusesForStop(uqStops[i]));\r\n    }\r\n\r\n    Promise.all(busPromises).then(values => {\r\n      values.forEach(value => stopTimes = stopTimes.concat(value));\r\n      stopTimes.forEach(busJSON => {\r\n        var bus = \r\n            new Bus(busJSON.trip_id, busJSON.stop_id, \r\n            busJSON.departure_time, this);\r\n        importedBuses.push(bus);\r\n      });\r\n\r\n      this.setState({\r\n        buses: importedBuses\r\n      });\r\n\r\n    });\r\n  }\r\n\r\n  render() {\r\n    return (\r\n    <div className=\"BusTable\">\r\n      <BusDisplayTable buses = {this.state.buses}/>\r\n    </div>\r\n    );\r\n  }\r\n}\r\n\r\nReactDOM.render(\r\n  <App></App>,\r\n  document.getElementById('root')\r\n);"],"sourceRoot":""}