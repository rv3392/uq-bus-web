{"version":3,"sources":["table_utils.js","bus/bus_display_table.js","bus/bus.js","bus/bus_display.js","loading_circle.js","service_updates_display.js","index.js"],"names":["useStyles","makeStyles","theme","table","minWidth","loading","display","marginTop","spacing","colorPrimary","convertBuses","busProps","buses","i","length","busProp","bus","no","routeShortName","route","routeLongName","stop","stopName","time","push","BusDisplayTable","props","useState","rows","setRows","setInitialRows","setLoading","classes","useEffect","busRowSorter","a","b","compareHours","parseInt","split","compareMinutes","getRows","useCallback","busMap","sort","map","TableRow","TableCell","align","console","log","getLoadingCircle","CircularProgress","color","style","getTable","TableContainer","component","Paper","Table","className","aria-label","width","TableHead","TableBody","apiURL","Bus","tripId","stopId","stateUpdateCallback","this","trip","isLoading","stopsDictionary","getTripPromise","then","locTrip","getRoutePromise","route_id","bind","locRoute","route_long_name","route_short_name","substring","getStopPromise","locStop","stop_name","fetch","res","json","routeId","tripUpdateId","uqStops","BusDisplay","setBuses","loadingBuses","setLoadingBuses","setIsLoading","getBuses","splice","indexOf","stops","toString","getUqStopsString","today_brisbane","brisbane_today","Date","toLocaleString","timezone","getBrisbaneTime","date","getFullYear","getMonth","padStart","getDate","dateToString","getHours","getMinutes","getSeconds","timeToString","stopTimes","forEach","busJSON","name","stop_id","trip_id","departure_time","VisibleLoadingCircle","HiddenLoadingCircle","LoadingCircle","setDisplay","uqLakesServices","getServiceUpdatesForService","service","jsonUpdates","serviceUpdateSorter","severity","ServiceUpdatesDisplayTable","updates","getBodyRows","update","title","dates","getBodyRow","ServiceUpdatesDisplay","setUpdates","getServiceUpdates","parsedUpdateIds","Set","numFinishedLoading","updatesJson","updateJson","has","id","add","ReactDOM","render","class","Grid","container","direction","alignItems","justify","item","src","process","alt","document","getElementById"],"mappings":"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","file":"static/js/main.1fe1f6bd.chunk.js","sourcesContent":["import { makeStyles } from '@material-ui/core/styles';\r\n\r\nexport function useStyles() {\r\n    return makeStyles(theme => ({\r\n        table: {\r\n            minWidth: 500,\r\n        },\r\n\r\n        loading: {\r\n            display: 'flex',\r\n            '& > * + *': {\r\n            marginTop: theme.spacing(2),\r\n            },\r\n            colorPrimary: \"#fff\"\r\n        },\r\n    }));\r\n}","import React, { useState, useEffect, useCallback } from 'react';\r\nimport Table from '@material-ui/core/Table';\r\nimport TableBody from '@material-ui/core/TableBody';\r\nimport TableCell from '@material-ui/core/TableCell';\r\nimport TableContainer from '@material-ui/core/TableContainer';\r\nimport TableHead from '@material-ui/core/TableHead';\r\nimport TableRow from '@material-ui/core/TableRow';\r\nimport Paper from '@material-ui/core/Paper';\r\nimport { makeStyles } from '@material-ui/core/styles';\r\nimport CircularProgress from '@material-ui/core/CircularProgress';\r\n\r\nimport { useStyles } from '../table_utils.js'\r\n\r\nfunction convertBuses(busProps) {\r\n  var buses = [];\r\n\r\n  for (var i = 0; i < busProps.length; i++) {\r\n      var busProp = busProps[i];\r\n      var bus = {no:busProp.routeShortName, route:busProp.routeLongName,\r\n          stop:busProp.stopName, time:busProp.time};\r\n      buses.push(bus);\r\n  }\r\n\r\n  return buses;\r\n}\r\n\r\nfunction BusDisplayTable(props) {\r\n  const [rows, setRows] = useState(convertBuses(props.buses));\r\n  const [initialRows, setInitialRows] = useState(convertBuses(props.buses));\r\n  const [loading, setLoading] = useState(props.loading);\r\n  const classes = useStyles();\r\n\r\n  useEffect(() => {\r\n    setRows(convertBuses(props.buses));\r\n    setInitialRows(rows);\r\n    setLoading(props.loading);\r\n  }, [props.buses, props.loading])\r\n\r\n  const busRowSorter = (a, b) => {\r\n    var compareHours = parseInt(a.time.split(\":\")[0]) - parseInt(b.time.split(\":\")[0])\r\n    var compareMinutes = parseInt(a.time.split(\":\")[1]) - parseInt(b.time.split(\":\")[1])\r\n\r\n    if (compareHours > 0) {\r\n      return 1\r\n    } else if (compareHours < 0) {\r\n      return -1\r\n    } else {\r\n      if (compareMinutes > 0) {\r\n        return 1\r\n      } else if (compareMinutes < 0) {\r\n        return -1\r\n      } else {\r\n        return 0\r\n      }\r\n    }\r\n  }\r\n\r\n  const getRows = useCallback(() => {\r\n    var busList = rows.sort(busRowSorter)\r\n    var busMap = busList.map(bus => {\r\n      return <TableRow>\r\n                <TableCell align = \"right\">{bus.no}</TableCell>\r\n                <TableCell>{bus.route}</TableCell>\r\n                <TableCell align = \"center\">{bus.stop}</TableCell>\r\n                <TableCell>{bus.time}</TableCell>\r\n              </TableRow>\r\n    })\r\n    console.log(busMap)\r\n    return busMap\r\n  }, [rows]);\r\n\r\n  const getLoadingCircle = useCallback(() => {\r\n    return (\r\n      <div align = \"center\">\r\n          {loading === 'loading' ? (\r\n            <div>\r\n              <br></br>\r\n              <CircularProgress color=\"primary\" style={{color:\"#fff\"}}/>\r\n            </div>\r\n          ) : (<div></div>)}\r\n        </div>\r\n    );\r\n  });\r\n\r\n  const getTable = useCallback(() => {\r\n    return (\r\n      <TableContainer component={Paper}>\r\n        <Table className={classes.table} aria-label=\"simple table\">\r\n          <colgroup>\r\n            <col style = {{width : '2%'}}/>\r\n            <col style = {{width : '83%'}}/>\r\n            <col style = {{width : '5%'}}/>\r\n            <col style = {{width : '10%'}}/>\r\n          </colgroup>\r\n          <TableHead>\r\n            <TableRow>\r\n              <TableCell></TableCell>\r\n              <TableCell align=\"left\">Route</TableCell>\r\n              <TableCell align=\"left\">Stop</TableCell>\r\n              <TableCell align=\"left\">Time</TableCell>\r\n            </TableRow>\r\n          </TableHead>\r\n          <TableBody>\r\n            {getRows()}\r\n          </TableBody>\r\n        </Table>\r\n      </TableContainer>\r\n    );\r\n  }, [classes]);\r\n\r\n  return (\r\n    <div>\r\n      {getTable()}\r\n      {getLoadingCircle()}\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default BusDisplayTable;","const apiURL = \"https://uq-bus-backend-api.herokuapp.com/\"\r\n\r\nclass Bus {\r\n    constructor(tripId, stopId, time, stateUpdateCallback) {\r\n  \r\n      this.tripId = tripId;\r\n      this.stopId = stopId;\r\n  \r\n      this.time = \"Loading... \";\r\n      this.trip = \"Loading... \";\r\n  \r\n      this.route = \"Loading...  \";\r\n      this.routeLongName = \"Loading...  \";\r\n      this.routeShortName = \"...\";\r\n  \r\n      this.stop = \"Loading...  \";\r\n      this.stopName = \"...\";\r\n\r\n      this.isLoading = true;\r\n\r\n      const stopsDictionary = {\"UQ Lakes, platform A\": \"A\",\r\n                                \"UQ Lakes, platform B\": \"B\",\r\n                                \"UQ Lakes, platform C\": \"C\",\r\n                                \"UQ Lakes, platform D\": \"D\",\r\n                                \"UQ Lakes, platform E\": \"E\",\r\n                                \"UQ Lakes station\": \"Any\"};\r\n  \r\n      var routePromise = this.getTripPromise(this.tripId).then(function(locTrip) {\r\n        this.trip = locTrip[0];\r\n\r\n        return this.getRoutePromise(locTrip[0].route_id);\r\n      }.bind(this));\r\n  \r\n      var timePromise = routePromise.then(function(locRoute) {\r\n        this.route = locRoute;\r\n        this.routeLongName = locRoute[0].route_long_name;\r\n        this.routeShortName = locRoute[0].route_short_name;\r\n      }.bind(this));\r\n  \r\n      var stopPromise = timePromise.then(function() {\r\n        this.time = time;\r\n        this.time = this.time.substring(0, 5);\r\n\r\n        return this.getStopPromise(stopId)\r\n      }.bind(this));\r\n  \r\n      var loadCompletePromise = stopPromise.then(function(locStop) {\r\n        this.stop = locStop;\r\n        this.stopName = stopsDictionary[locStop[0].stop_name];\r\n      }.bind(this));\r\n  \r\n      loadCompletePromise.then(function() {\r\n        this.isLoading = false;\r\n        stateUpdateCallback(this);\r\n      }.bind(this));\r\n    }\r\n  \r\n    getTripPromise(tripId) {\r\n      return fetch(apiURL + \"/trip/trip_id/\" + tripId + \"/\")\r\n          .then(res => res.json());\r\n    }\r\n  \r\n    getRoutePromise(routeId) {\r\n      return fetch(apiURL + \"/route/route_id/\" + routeId + \"/\")\r\n          .then(res => res.json());\r\n    }\r\n  \r\n    getStopPromise(stopId) {\r\n      return fetch(apiURL + \"/stop/stop_id/\" + stopId + \"/\")\r\n          .then(res => res.json());\r\n    }\r\n  \r\n    getTripUpdatePromise(tripId) {\r\n      return fetch(apiURL + \"/trip_update/trip_id/\" + tripId + \"/\")\r\n          .then(res => res.json());\r\n    }\r\n  \r\n    getStopTimeUpdate(tripUpdateId) {\r\n      return fetch(apiURL + \"/stop_time_update/trip_update_id/\" + tripUpdateId + \"/\")\r\n          .then(res => res.json());\r\n    }\r\n  }\r\n\r\n  export default Bus;","import React, { useState, useEffect, useCallback } from 'react';\r\n\r\nimport BusDisplayTable from './bus_display_table.js';\r\nimport Bus from './bus.js';\r\n\r\nconst uqStops = [\"1853\", \"1877\", \"1878\", \"1880\", \"1883\", \"1882\"];\r\nconst apiURL = \"https://uq-bus-backend-api.herokuapp.com/\" //http://uqbus.richal.tech/\r\n\r\nfunction getBrisbaneTime() {\r\n    var today = new Date();\r\n    var brisbane_today = today.toLocaleString('en-US', {timezone: \"Australia/Brisbane\"})\r\n    return new Date(brisbane_today);\r\n}\r\n\r\nfunction dateToString(date) {\r\n    return date.getFullYear() + '-' \r\n            + (date.getMonth() + 1).toString().padStart(2, \"0\") + '-' \r\n            + date.getDate().toString().padStart(2, \"0\");\r\n}\r\n\r\nfunction timeToString(date) {\r\n    return date.getHours().toString().padStart(2, \"0\") \r\n        + ':' + date.getMinutes().toString().padStart(2, \"0\") \r\n        + ':' + date.getSeconds().toString().padStart(2, \"0\");\r\n}\r\n\r\nfunction getUqStopsString() {\r\n    var stops = \"\";\r\n    for (var i = 0; i < uqStops.length; i++) {\r\n        stops = i === uqStops.length - 1 ? stops.toString() + uqStops[i].toString() : \r\n                stops.toString() + uqStops[i].toString() + \",\"; \r\n    }\r\n\r\n    return stops;\r\n}\r\n\r\nfunction BusDisplay(props) {\r\n    const [buses, setBuses] = useState([])\r\n    const [loadingBuses, setLoadingBuses] = useState([])\r\n    const [isLoading, setIsLoading] = useState(\"loading\")\r\n\r\n    useEffect(() => {\r\n        getBuses();\r\n    }, []);\r\n\r\n    const stateUpdateCallback = useCallback((bus) => {\r\n        console.log(\"Finished Loading: \", bus);\r\n        \r\n        // Remove bus that just finished loading and check if there are any others remaining\r\n        setLoadingBuses((loadingBuses) => loadingBuses.splice(loadingBuses.indexOf(bus)));\r\n        if (loadingBuses.length == 0) {\r\n            setIsLoading(\"done\");\r\n        } else {\r\n            setIsLoading(\"loading\");\r\n        }\r\n\r\n        setBuses(buses => [...buses, bus]);\r\n    });\r\n\r\n    const getBuses = useCallback(() => {\r\n        var stops = getUqStopsString();\r\n\r\n        var today_brisbane = getBrisbaneTime();\r\n        var date = dateToString(today_brisbane);\r\n        var time = timeToString(today_brisbane);        \r\n        \r\n        // Load all of the scheduled buses at this time and for some time afterwards\r\n        var busPromises = fetch(apiURL + \"/stop_time?time=\" + date + \" \" + time + \r\n                \"&stop_id=\" + stops).then(res => { return res.json(); });\r\n\r\n        busPromises.then(stopTimes => {\r\n            stopTimes.forEach(busJSON => {\r\n                if ((props.name === \"Departing\" && busJSON.stop_id !== \"1882\") ||\r\n                        (props.name === \"Arriving\" && busJSON.stop_id === \"1882\")) {\r\n                    const bus = new Bus(busJSON.trip_id, busJSON.stop_id, busJSON.departure_time, stateUpdateCallback);\r\n                    setLoadingBuses(loadingBuses => [...loadingBuses, bus]);\r\n                }\r\n            });\r\n        });\r\n    });\r\n\r\n    return (\r\n        <div className=\"BusTable\">\r\n            <h3>{props.name}</h3>\r\n            <BusDisplayTable loading = {isLoading} buses = {buses}/>\r\n        </div>\r\n    );\r\n\r\n}\r\n\r\nexport default BusDisplay;","import React, { useState, useEffect } from 'react';\r\nimport CircularProgress from '@material-ui/core/CircularProgress';\r\n\r\nfunction VisibleLoadingCircle() {\r\n    return (\r\n        <div align=\"center\">\r\n            <br></br>\r\n            <CircularProgress color=\"primary\" style={{color:\"#fff\"}}/>\r\n        </div>\r\n    );\r\n}\r\n\r\nfunction HiddenLoadingCircle() {\r\n    return (<div align=\"center\"></div>);\r\n}\r\n\r\nexport function LoadingCircle(props) {\r\n    const [display, setDisplay] = useState(true);\r\n\r\n    useEffect(() => {\r\n        setDisplay(props.isLoading);\r\n    }, [props.isLoading])\r\n\r\n    return display ? (<VisibleLoadingCircle></VisibleLoadingCircle>) : (<HiddenLoadingCircle></HiddenLoadingCircle>);\r\n}","import React, { useState, useEffect, useCallback } from 'react';\r\n\r\nimport Table from '@material-ui/core/Table';\r\nimport TableBody from '@material-ui/core/TableBody';\r\nimport TableCell from '@material-ui/core/TableCell';\r\nimport TableContainer from '@material-ui/core/TableContainer';\r\nimport TableHead from '@material-ui/core/TableHead';\r\nimport TableRow from '@material-ui/core/TableRow';\r\nimport Paper from '@material-ui/core/Paper';\r\n\r\nimport { useStyles } from './table_utils.js';\r\nimport { LoadingCircle } from './loading_circle.js';\r\n\r\nconst apiURL = \"https://uq-bus-backend-api.herokuapp.com/\"\r\nconst uqLakesServices = [\"28\", \"29\", \"66\", \"129\", \"139\", \"169\", \"192\", \"209\"]\r\n\r\nasync function getServiceUpdatesForService(service) {\r\n    let jsonUpdates = await fetch(apiURL + \"/service_updates/affected_service/\" + service)\r\n    return await jsonUpdates.json();\r\n}\r\n\r\nfunction serviceUpdateSorter(a, b) {\r\n    if ((a.severity === \"Informative\" && (b.severity === \"Minor\" || b.severity === \"Major\")) \r\n            || (a.severity === \"Minor\" && b.severity === \"Major\")) {\r\n        return 1;\r\n    } else if ((a.severity === \"Informative\" && b.severity === \"Informative\")\r\n            || (a.severity === \"Minor\" && b.severity === \"Minor\")\r\n            || (a.severity === \"Major\" && b.severity === \"Major\")) {\r\n        return 0;\r\n    } else {\r\n        return -1;\r\n    }\r\n}\r\n\r\nfunction ServiceUpdatesDisplayTable(props) {\r\n    const [rows, setRows] = useState([]);\r\n    const classes = useStyles();\r\n\r\n    useEffect(() => {\r\n        setRows(props.updates);\r\n    }, [props.updates]);\r\n\r\n    const getHeader = () => {\r\n        return (\r\n            <TableRow>\r\n              <TableCell align=\"left\">Severity</TableCell>\r\n              <TableCell align=\"left\">Description</TableCell>\r\n              <TableCell align=\"center\">Date</TableCell>\r\n            </TableRow>\r\n        );\r\n    };\r\n\r\n    const getBodyRow = (update) => {\r\n        return (\r\n            <TableRow>\r\n                <TableCell align = \"left\">{update.severity}</TableCell>\r\n                <TableCell>{update.title}</TableCell>\r\n                <TableCell align = \"center\">{update.dates}</TableCell>\r\n            </TableRow>\r\n        );\r\n    }\r\n\r\n    const getBodyRows = useCallback(() => {\r\n        const sortedRows = rows.sort(serviceUpdateSorter);\r\n        return sortedRows.map(update => {return getBodyRow(update);});\r\n    }, [rows]);\r\n\r\n    return (\r\n        <TableContainer component={Paper}>\r\n        <Table className={classes.table} aria-label=\"simple table\">\r\n          <colgroup>\r\n            <col style = {{width : '15%'}}/>\r\n            <col style = {{width : '60%'}}/>\r\n            <col style = {{width : '25%'}}/>\r\n          </colgroup>\r\n          <TableHead>\r\n            {getHeader()}\r\n          </TableHead>\r\n          <TableBody>\r\n            {getBodyRows()}\r\n          </TableBody>\r\n        </Table>\r\n      </TableContainer>\r\n    );\r\n}\r\n\r\nfunction ServiceUpdatesDisplay() {\r\n    const [updates, setUpdates] = useState([]);\r\n    const [isLoading, setIsLoading] = useState(true);\r\n\r\n    const getServiceUpdates = async () => {\r\n        var parsedUpdateIds = new Set();\r\n        var numFinishedLoading = 0;\r\n\r\n        // Initiate fetch calls for each service and handle the updates received\r\n        uqLakesServices.forEach(service => {\r\n            getServiceUpdatesForService(service)\r\n                .then(updatesJson => {\r\n                    updatesJson.forEach(updateJson => {\r\n                        if (!parsedUpdateIds.has(updateJson.id)) {\r\n                            parsedUpdateIds.add(updateJson.id);\r\n                            setUpdates(updates => [...updates, updateJson]);\r\n                            console.log(updateJson);\r\n                        }\r\n                    });\r\n\r\n                    // This works but surely there's a better way\r\n                    numFinishedLoading++;\r\n                    if (numFinishedLoading == uqLakesServices.length) {\r\n                        setIsLoading(false);\r\n                    }\r\n                });\r\n        });\r\n    }\r\n\r\n    useEffect(() => {\r\n        getServiceUpdates();\r\n    }, []);\r\n\r\n    return (\r\n        <div>\r\n            <ServiceUpdatesDisplayTable updates={updates}></ServiceUpdatesDisplayTable>\r\n            <LoadingCircle isLoading={isLoading}></LoadingCircle>\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default ServiceUpdatesDisplay;","import React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport Grid from '@material-ui/core/Grid';\r\nimport './index.css';\r\n\r\nimport BusDisplay from './bus/bus_display.js';\r\nimport ServiceUpdatesDisplay from './service_updates_display.js';\r\n\r\nfunction App() {\r\n    return (\r\n      <div>\r\n        <div class=\"title\">\r\n          <Grid container spacing={0} direction=\"row\" alignItems=\"center\" justify=\"center\">\r\n            <Grid item>\r\n              <img align=\"right\" src={process.env.PUBLIC_URL + '/busWhite96.png'} alt=\"\"/>\r\n            </Grid>\r\n            <Grid item>\r\n              <h1 align = \"left\">UQBus</h1>\r\n            </Grid>\r\n          </Grid>\r\n      </div>\r\n      <div class=\"service-updates\">\r\n        <h2 align=\"center\">Service Updates</h2>\r\n        <Grid container spacing={0} direction=\"column\" alignItems=\"center\" justify=\"center\">\r\n          <Grid item style = {{minWidth: 345, width: \"60%\"}}>\r\n                <ServiceUpdatesDisplay></ServiceUpdatesDisplay>\r\n          </Grid>\r\n        </Grid>\r\n      </div>\r\n      <div class=\"uq-lakes-tables\">\r\n          <h2 align = \"center\">UQ Lakes</h2>\r\n          <Grid container spacing={0} direction=\"column\" alignItems=\"center\" justify=\"center\">\r\n            <Grid item style = {{minWidth: 345, width: \"60%\"}}>\r\n              <BusDisplay name = \"Departing\"></BusDisplay>\r\n            </Grid>\r\n            <Grid item style = {{minWidth: 345, width: \"60%\"}}>\r\n              <BusDisplay name = \"Arriving\"></BusDisplay>\r\n            </Grid>\r\n          </Grid>\r\n        </div>\r\n      </div>\r\n    );\r\n}\r\n\r\nReactDOM.render(\r\n  <App></App>,\r\n  document.getElementById('root')\r\n);"],"sourceRoot":""}