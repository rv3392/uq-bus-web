(this["webpackJsonpuq-bus-web"]=this["webpackJsonpuq-bus-web"]||[]).push([[0],{22:function(t,e,n){},27:function(t,e,n){t.exports=n(36)},36:function(t,e,n){"use strict";n.r(e);var a=n(9),i=n(6),r=n(12),s=n(13),o=n(14),l=n(0),u=n.n(l),c=n(23),h=n.n(c),m=n(68),p=(n(22),n(65)),g=n(67),d=n(61),f=n(63),b=n(66),E=n(60),v=n(64),y=n(58),S=n(62),k=function(t){function e(){var t,n;Object(a.a)(this,e);for(var i=arguments.length,o=new Array(i),l=0;l<i;l++)o[l]=arguments[l];return(n=Object(r.a)(this,(t=Object(s.a)(e)).call.apply(t,[this].concat(o)))).state={rows:n.convertBuses(n.props.buses),initialRows:n.convertBuses(n.props.buses),loading:n.props.loading,classes:n.useStyles()},n}return Object(o.a)(e,t),Object(i.a)(e,[{key:"useStyles",value:function(){return Object(y.a)((function(t){return{table:{minWidth:500},loading:{display:"flex","& > * + *":{marginTop:t.spacing(2)},colorPrimary:"#fff"}}}))}},{key:"convertBuses",value:function(t){for(var e=[],n=0;n<t.length;n++){var a=t[n],i={no:a.routeShortName,route:a.routeLongName,stop:a.stopName,time:a.time};e.push(i)}return e}},{key:"componentDidMount",value:function(){this.setState({rows:this.convertBuses(this.props.buses),initialRows:this.state.rows,loading:this.props.loading})}},{key:"componentWillReceiveProps",value:function(t){this.setState({rows:this.convertBuses(this.props.buses),initialRows:this.state.rows,loading:this.props.loading})}},{key:"getRows",value:function(){return this.state.rows.map((function(t){return u.a.createElement(E.a,null,u.a.createElement(d.a,{align:"right"},t.no),u.a.createElement(d.a,null,t.route),u.a.createElement(d.a,{align:"center"},t.stop),u.a.createElement(d.a,null,t.time))}))}},{key:"getLoadingCircle",value:function(){return u.a.createElement("div",{align:"center"},"loading"===this.state.loading?u.a.createElement("div",null,u.a.createElement("br",null),u.a.createElement(S.a,{color:"primary",style:{color:"#fff"}})):u.a.createElement("div",null))}},{key:"getTable",value:function(){return u.a.createElement(f.a,{component:v.a},u.a.createElement(p.a,{className:this.state.classes.table,"aria-label":"simple table"},u.a.createElement("colgroup",null,u.a.createElement("col",{style:{width:"2%"}}),u.a.createElement("col",{style:{width:"83%"}}),u.a.createElement("col",{style:{width:"5%"}}),u.a.createElement("col",{style:{width:"10%"}})),u.a.createElement(b.a,null,u.a.createElement(E.a,null,u.a.createElement(d.a,null),u.a.createElement(d.a,{align:"left"},"Route"),u.a.createElement(d.a,{align:"left"},"Stop"),u.a.createElement(d.a,{align:"left"},"Time"))),u.a.createElement(g.a,null,this.getRows())))}},{key:"render",value:function(){return u.a.createElement("div",null,this.getTable(),this.getLoadingCircle())}}]),e}(u.a.Component),w="http://uqbus.richal.tech",j=function(){function t(e,n,i,r){Object(a.a)(this,t),this.tripId=e,this.stopId=n,this.time="Loading... ",this.trip="Loading... ",this.route="Loading...  ",this.routeLongName="Loading...  ",this.routeShortName="...",this.stop="Loading...  ",this.stopName="...",this.isLoading=!0;var s={"UQ Lakes, platform A":"A","UQ Lakes, platform B":"B","UQ Lakes, platform C":"C","UQ Lakes, platform D":"D","UQ Lakes, platform E":"E","UQ Lakes station":"Any"};this.getTripPromise(this.tripId).then(function(t){return this.trip=t[0],this.getRoutePromise(t[0].route_id)}.bind(this)).then(function(t){this.route=t,this.routeLongName=t[0].route_long_name,this.routeShortName=t[0].route_short_name}.bind(this)).then(function(){return this.time=i,this.time=this.time.substring(0,5),this.getStopPromise(n)}.bind(this)).then(function(t){this.stop=t,this.stopName=s[t[0].stop_name]}.bind(this)).then(function(){this.isLoading=!1,r.stateUpdateCallback(this)}.bind(this))}return Object(i.a)(t,[{key:"getTripPromise",value:function(t){return fetch(w+"/trip/trip_id/"+t+"/").then((function(t){return t.json()}))}},{key:"getRoutePromise",value:function(t){return fetch(w+"/route/route_id/"+t+"/").then((function(t){return t.json()}))}},{key:"getStopPromise",value:function(t){return fetch(w+"/stop/stop_id/"+t+"/").then((function(t){return t.json()}))}},{key:"getTripUpdatePromise",value:function(t){return fetch(w+"/trip_update/trip_id/"+t+"/").then((function(t){return t.json()}))}},{key:"getStopTimeUpdate",value:function(t){return fetch(w+"/stop_time_update/trip_update_id/"+t+"/").then((function(t){return t.json()}))}}]),t}(),_=["1853","1877","1878","1880","1883","1882"],L=function(t){function e(){var t,n;Object(a.a)(this,e);for(var i=arguments.length,o=new Array(i),l=0;l<i;l++)o[l]=arguments[l];return(n=Object(r.a)(this,(t=Object(s.a)(e)).call.apply(t,[this].concat(o)))).state={buses:[],loadingBuses:[],isLoading:"loading"},n}return Object(o.a)(e,t),Object(i.a)(e,[{key:"componentDidMount",value:function(){this.getBuses()}},{key:"stateUpdateCallback",value:function(t){var e="done";console.log(t);var n=this.state.buses.concat([t]);this.state.loadingBuses.forEach((function(t){return!0===t.isLoading?e="loading":e})),this.setState({buses:n,isLoading:e}),this.forceUpdate()}},{key:"getBuses",value:function(){for(var t=this,e="",n=new Date,a=new Date(n.toLocaleString("en-US",{timezone:"Australia/Brisbane"})),i=a.getFullYear()+"-"+(a.getMonth()+1).toString().padStart(2,"0")+"-"+a.getDate().toString().padStart(2,"0"),r=a.getHours().toString().padStart(2,"0")+":"+a.getMinutes().toString().padStart(2,"0")+":"+a.getSeconds().toString().padStart(2,"0"),s=0;s<_.length;s++)e=s===_.length-1?e.toString()+_[s].toString():e.toString()+_[s].toString()+",";fetch("http://uqbus.richal.tech/stop_time?time="+i+" "+r+"&stop_id="+e).then((function(t){return t.json()})).then((function(e){e.forEach((function(e){var n=[];console.log(e),"Departing"===t.props.name?(console.log(e),"1882"!==e.stop_id&&(n=[new j(e.trip_id,e.stop_id,e.departure_time,t)],t.setState({loadingBuses:t.state.loadingBuses.concat(n)}))):"Arriving"===t.props.name&&"1882"===e.stop_id&&(n=[new j(e.trip_id,e.stop_id,e.departure_time,t)],t.setState({loadingBuses:t.state.loadingBuses.concat(n)}))}))}))}},{key:"render",value:function(){return u.a.createElement("div",{className:"BusTable"},u.a.createElement("h3",null,this.props.name),u.a.createElement(k,{loading:this.state.isLoading,buses:this.state.buses}))}}]),e}(u.a.Component),B=function(t){function e(){return Object(a.a)(this,e),Object(r.a)(this,Object(s.a)(e).apply(this,arguments))}return Object(o.a)(e,t),Object(i.a)(e,[{key:"render",value:function(){return u.a.createElement("div",null,u.a.createElement("div",{class:"title"},u.a.createElement(m.a,{container:!0,spacing:0,direction:"row",alignItems:"center",justify:"center"},u.a.createElement(m.a,{item:!0},u.a.createElement("img",{align:"right",src:"/uq-bus-web/busWhite96.png",alt:""})),u.a.createElement(m.a,{item:!0},u.a.createElement("h1",{align:"left"},"UQBus")))),u.a.createElement("div",{class:"uq-lakes-tables"},u.a.createElement("h2",{align:"center"},"UQ Lakes"),u.a.createElement(m.a,{container:!0,spacing:0,direction:"column",alignItems:"center",justify:"center"},u.a.createElement(m.a,{item:!0,style:{minWidth:345,width:"60%"}},u.a.createElement(L,{name:"Departing"})),u.a.createElement(m.a,{item:!0,style:{minWidth:345,width:"60%"}},u.a.createElement(L,{name:"Arriving"})))))}}]),e}(u.a.Component);h.a.render(u.a.createElement(B,null),document.getElementById("root"))}},[[27,1,2]]]);
//# sourceMappingURL=main.b3ee90b1.chunk.js.map